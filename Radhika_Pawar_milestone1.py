# -*- coding: utf-8 -*-
"""Milestone1.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1DAN0U_JnioU8O6F33ajwfx4xJMNxbet-
"""

import pandas as pd
from sklearn.preprocessing import LabelEncoder

# -----------------------------
# 1. LOAD DATA
# -----------------------------
df = pd.read_csv("Visa_Status_Prediction_Dataset.csv")   # change filename accordingly

# -----------------------------
# 2. DROP UNUSED COLUMNS
# -----------------------------
df.drop(columns=["case_id"], inplace=True)

# -----------------------------
# 3. HANDLE MISSING VALUES
# -----------------------------
# Categorical columns
categorical_cols = ["continent", "education_of_employee", "region_of_employment", "unit_of_wage"]
for col in categorical_cols:
    df[col] = df[col].fillna("Unknown")

# Binary Y/N columns
binary_cols = ["has_job_experience", "requires_job_training", "full_time_position"]
for col in binary_cols:
    df[col] = df[col].fillna("N")

# Numeric columns
numeric_cols = ["no_of_employees", "yr_of_estab", "prevailing_wage"]
for col in numeric_cols:
    df[col] = df[col].fillna(df[col].median())

# -----------------------------
# 4. CONVERT Y/N TO 0/1
# -----------------------------
for col in binary_cols:
    df[col] = df[col].map({"Y": 1, "N": 0})

# -----------------------------
# 5. FEATURE ENGINEERING
# -----------------------------
# Company age from establishment year
df["company_age"] = 2025 - df["yr_of_estab"]

# Normalize wages (optional)
# Idea: Convert Hour â†’ Year equivalent (assuming 2080 hours/year)
df.loc[df["unit_of_wage"] == "Hour", "prevailing_wage"] *= 2080

# Education Ordinal Encoding
education_order = {
    "High School": 1,
    "Bachelor's": 2,
    "Master's": 3,
    "Doctorate": 4,
    "Unknown": 0
}
df["education_level"] = df["education_of_employee"].map(education_order)

# -----------------------------
# 6. LABEL ENCODE OTHER CATEGORICAL VARIABLES
# -----------------------------
label_encode_cols = ["continent", "region_of_employment", "unit_of_wage"]

le = LabelEncoder()
for col in label_encode_cols:
    df[col] = le.fit_transform(df[col])

# -----------------------------
# 7. ENCODE TARGET VARIABLE
# -----------------------------
# Convert case_status into binary: Certified = 1, Denied = 0
df["case_status"] = df["case_status"].map({
    "Certified": 1,
    "Denied": 0
})

# Remove rows with other statuses (optional)
df = df[df["case_status"].isin([0, 1])]

# -----------------------------
# 8. SAVE CLEANED DATASET
# -----------------------------
df.to_csv("visa_data_cleaned.csv", index=False)

print("Preprocessing complete! Saved as visa_data_cleaned.csv")
df.head()

